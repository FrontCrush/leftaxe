// Generated by CoffeeScript 1.6.2
var Dungeon, Room;

Dungeon = (function() {
  var BLANK_TILE, FLOOR_TILE, WALL_TILE;

  BLANK_TILE = 0;

  FLOOR_TILE = 1;

  WALL_TILE = 2;

  function Dungeon(map_width, map_height, max_features, room_chance) {
    var x, y;

    this.map_width = map_width;
    this.map_height = map_height;
    this.max_features = max_features;
    this.room_chance = room_chance;
    this.tiles = [];
    this.fill_map();
    x = Math.floor(this.map_width / 2);
    y = Math.floor(this.map_height / 2);
    this.make_room(x, y, 4, 4);
  }

  Dungeon.prototype.fill_map = function() {
    var row, x, y, _i, _j, _ref, _ref1, _results;

    _results = [];
    for (y = _i = 1, _ref = this.map_height; 1 <= _ref ? _i <= _ref : _i >= _ref; y = 1 <= _ref ? ++_i : --_i) {
      row = [];
      for (x = _j = 1, _ref1 = this.map_width; 1 <= _ref1 ? _j <= _ref1 : _j >= _ref1; x = 1 <= _ref1 ? ++_j : --_j) {
        row.push(BLANK_TILE);
      }
      _results.push(this.tiles.push(row));
    }
    return _results;
  };

  Dungeon.prototype.make_room = function(x, y, width, height) {
    var room;

    room = new Room(x, y, width, height, this);
    return room.build();
  };

  Dungeon.prototype.get_tile = function(x, y) {
    return this.tiles[y][x];
  };

  Dungeon.prototype.set_tile = function(x, y, tile) {
    return this.tiles[y][x] = tile;
  };

  Dungeon.prototype.is_blank_tile = function(x, y) {
    return this.get_tile(x, y) === BLANK_TILE;
  };

  Dungeon.prototype.set_wall_tile = function(x, y) {
    return this.set_tile(x, y, WALL_TILE);
  };

  Dungeon.prototype.set_floor_tile = function(x, y) {
    return this.set_tile(x, y, FLOOR_TILE);
  };

  return Dungeon;

})();

Room = (function() {
  function Room(x, y, width, height, dungeon) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    this.dungeon = dungeon;
    this.xlen = Math.floor((Math.random() * this.width) + 4);
    this.ylen = Math.floor((Math.random() * this.height) + 4);
    console.log(this.xlen);
    console.log(this.ylen);
  }

  Room.prototype.build = function() {
    var xtemp, ytemp;

    if (!this.has_enough_space()) {
      return false;
    }
    ytemp = this.y;
    while (ytemp > (this.y - this.ylen)) {
      xtemp = this.x - Math.floor(this.xlen / 2);
      while (xtemp < (this.x + Math.floor((this.xlen + 1) / 2))) {
        if (xtemp === (this.x - Math.floor(this.xlen / 2))) {
          this.dungeon.set_wall_tile(xtemp, ytemp);
        } else if (xtemp === (this.x + Math.floor((this.xlen - 1) / 2))) {
          this.dungeon.set_wall_tile(xtemp, ytemp);
        } else if (ytemp === this.y) {
          this.dungeon.set_wall_tile(xtemp, ytemp);
        } else if (ytemp === (this.y - this.ylen + 1)) {
          this.dungeon.set_wall_tile(xtemp, ytemp);
        } else {
          this.dungeon.set_floor_tile(xtemp, ytemp);
        }
        xtemp += 1;
      }
      ytemp -= 1;
    }
    return true;
  };

  Room.prototype.has_enough_space = function() {
    var xtemp, ytemp;

    ytemp = this.y;
    while (ytemp > (this.y - this.ylen)) {
      if (ytemp < 0 || ytemp > this.dungeon.map_height) {
        return false;
      }
      xtemp = this.x - Math.floor(this.xlen / 2);
      while (xtemp < (this.x + Math.floor((this.xlen + 1) / 2))) {
        if (xtemp < 0 || xtemp > this.dungeon.map_width) {
          return false;
        }
        if (!this.dungeon.is_blank_tile(xtemp, ytemp)) {
          return false;
        }
        xtemp += 1;
      }
      ytemp -= 1;
    }
    return true;
  };

  return Room;

})();
